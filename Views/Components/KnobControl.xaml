<UserControl x:Class="CapnoAnalyzer.Views.Components.KnobControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             x:Name="Root"
             Width="50" Height="70"
             MouseWheel="OnMouseWheel"
             MouseMove="OnMouseMove"
             MouseLeftButtonDown="OnMouseLeftDown"
             MouseLeftButtonUp="OnMouseLeftUp"
             MouseRightButtonDown="OnMouseRightDown"
             Cursor="Hand"
             ToolTip="Ölçeği ayarlamak için fare tekerleğini veya tıklayıp çevirmeyi kullanın. 0 = AUTO. Ayarlar için sağ tıklayın.">
    <Grid>
        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" Background="Transparent" ToolTip="{Binding Title, ElementName=Root}">
            <TextBlock Text="{Binding Title, ElementName=Root}" Foreground="#5C6D8C" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,2"/>
            <Grid Width="36" Height="36">
                <Ellipse Fill="#E5E7EB" Stroke="#D1D5DB" StrokeThickness="1"/>
                <Ellipse Fill="#F1F3FA" Width="28" Height="28" Stroke="#FFFFFF" StrokeThickness="1">
                    <Ellipse.Effect>
                        <DropShadowEffect Color="#000000" Opacity="0.1" ShadowDepth="1" BlurRadius="2"/>
                    </Ellipse.Effect>
                </Ellipse>
                <Path Stroke="#0078D7" StrokeThickness="2.5" StrokeLineJoin="Round" StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                      RenderTransformOrigin="0.5,0.5">
                    <Path.Data>
                        <GeometryGroup>
                            <LineGeometry StartPoint="18,18" EndPoint="18,6" />
                        </GeometryGroup>
                    </Path.Data>
                    <Path.RenderTransform>
                        <RotateTransform Angle="{Binding Angle, ElementName=Root}" />
                    </Path.RenderTransform>
                </Path>
            </Grid>
            <TextBlock Text="{Binding FormatValue, ElementName=Root}" Foreground="#2E3B4E" FontSize="11" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Right Click Configuration Popup -->
        <Popup x:Name="SettingsPopup" StaysOpen="False" Placement="MousePoint" AllowsTransparency="True">
            <Border Background="#FFFFFF" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="5" Padding="10">
                <Border.Effect>
                    <DropShadowEffect Color="#000000" Opacity="0.1" ShadowDepth="2" BlurRadius="5"/>
                </Border.Effect>
                <StackPanel Orientation="Vertical">
                    <TextBlock Text="Scale Configuration" FontSize="12" FontWeight="Bold" Foreground="#2E3B4E" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                    
                    <Grid Margin="0,0,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition Width="60" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Max:" VerticalAlignment="Center" FontSize="11" Foreground="#5C6D8C"/>
                        <TextBox Grid.Column="1" Text="{Binding Maximum, ElementName=Root, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" 
                                 Padding="2" FontSize="11" BorderBrush="#E5E7EB" BorderThickness="1" HorizontalContentAlignment="Center"/>
                    </Grid>
                    
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition Width="60" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Step:" VerticalAlignment="Center" FontSize="11" Foreground="#5C6D8C"/>
                        <TextBox Grid.Column="1" Text="{Binding Step, ElementName=Root, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" 
                                 Padding="2" FontSize="11" BorderBrush="#E5E7EB" BorderThickness="1" HorizontalContentAlignment="Center"/>
                    </Grid>

                    <Button Content="Zemine Tıkla (X)" Background="#EF4444" Foreground="White" FontSize="10" BorderThickness="0" Padding="0,3"
                            Click="OnClosePopupClick" Cursor="Hand" ToolTip="Kapatmak için ekranda boş bir yere de tıklayabilirsiniz."/>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</UserControl>
